{
  "Multi-stage Node and Angular Dockerfile": {
    "prefix": "docker-angular-node-multi-stage",
    "body": [
      "# Client App",
      "FROM johnpapa/angular-cli as client-app",
      "LABEL authors=\"${1:John Papa}\"",
      "WORKDIR /usr/src/app",
      "COPY [\"package.json\", \"npm-shrinkwrap.json*\", \"./\"]",
      "RUN npm install --silent",
      "COPY . .",
      "RUN ng build --prod",
      "",
      "# Node server",
      "FROM ${2:node:8.11-alpine} as node-server",
      "WORKDIR /usr/src/app",
      "COPY [\"package.json\", \"npm-shrinkwrap.json*\", \"./\"]",
      "RUN npm install --production --silent && mv node_modules ../",
      "COPY ${3:/src/server} /usr/src/app",
      "",
      "# Final image",
      "FROM ${2:node:8.11-alpine}",
      "WORKDIR /usr/src/app",
      "COPY --from=node-server /usr/src /usr/src",
      "COPY --from=client-app /usr/src/app ./",
      "EXPOSE ${4:3000}",
      "CMD [\"node\", \"index.js\"]",
      "$0"
    ],
    "description": "Multi-stage Node and Angular Dockerfile"
  },
  "Multi-stage nginx and Angular Dockerfile": {
    "prefix": "docker-angular-nginx-multi-stage",
    "body": [
      "# Client App",
      "FROM johnpapa/angular-cli as client-app",
      "LABEL authors=\"${1:John Papa}\"",
      "WORKDIR /usr/src/app",
      "COPY [\"package.json\", \"npm-shrinkwrap.json*\", \"./\"]",
      "RUN npm install --silent",
      "COPY . .",
      "RUN ng build --prod",
      "",
      "# nginx server",
      "FROM ${2:nginx:alpine} as nginx-server",
      "WORKDIR /usr/src/app",
      "# Copy custom nginx config",
      "COPY ./nginx.conf /etc/nginx/nginx.conf",
      "# Copy in the client app",
      "COPY --from=client-app /usr/src/app/dist .",
      "EXPOSE 80 443",
      "ENTRYPOINT [\"nginx\", \"-g\", \"daemon off;\"]",
      "$0"
    ],
    "description": "Multi-stage nginx and Angular Dockerfile"
  }
}
